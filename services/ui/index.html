<!doctype html>
<html lang="en" data-bs-theme="dark">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Text2SQL – Playground</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
  <link href="./assets/css/app.css" rel="stylesheet" />
</head>
<body class="bg-dark text-light">
  <header class="sticky-top border-bottom border-secondary-subtle bg-dark">
    <div class="container py-3 d-flex align-items-center gap-3 flex-wrap">
      <h1 class="h4 m-0">Text2SQL – Playground</h1>
      <div class="ms-auto d-flex align-items-center gap-2">
        <input id="baseUrl" class="form-control form-control-sm" style="width: 320px" placeholder="http://localhost:8000" />
        <button class="btn btn-sm btn-primary" id="saveBase">Save</button>
        <span class="badge rounded-pill text-bg-secondary" id="statusDot">offline</span>
      </div>
    </div>
  </header>

  <main class="container my-4">
    <ul class="nav nav-tabs" id="tabs" role="tablist">
      <li class="nav-item" role="presentation"><button class="nav-link active" data-bs-toggle="tab" data-bs-target="#tab-health" type="button" role="tab">Health</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-index" type="button" role="tab">Index</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-search" type="button" role="tab">Search</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-ask" type="button" role="tab">Ask (RAG)</button></li>
      <li class="nav-item" role="presentation"><button class="nav-link" data-bs-toggle="tab" data-bs-target="#tab-sql" type="button" role="tab">Text2SQL</button></li>
    </ul>

    <div class="tab-content">
      <!-- Health -->
      <section class="tab-pane fade show active p-3" id="tab-health" role="tabpanel">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="d-flex gap-2 align-items-center mb-2">
              <button class="btn btn-success" id="btnHealth">Check health</button>
              <span class="text-secondary small">Checks API → Qdrant / Ollama readiness</span>
            </div>
            <pre id="outHealth" class="codebox"></pre>
          </div>
        </div>
      </section>

      <!-- Index -->
      <section class="tab-pane fade p-3" id="tab-index" role="tabpanel">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-3">
                <label class="form-label">Point ID (optional)</label>
                <input id="idxId" class="form-control" placeholder="auto-UUID if empty" />
              </div>
              <div class="col-md-9">
                <label class="form-label">Metadata (JSON, optional)</label>
                <textarea id="idxMeta" class="form-control" rows="3" placeholder='{"source":"ui","topic":"demo"}'></textarea>
              </div>
              <div class="col-12">
                <label class="form-label">Text</label>
                <textarea id="idxText" class="form-control" rows="5" placeholder="Paste text to index"></textarea>
              </div>
            </div>
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-primary" id="btnIndex">Index</button>
              <button class="btn btn-outline-light" id="btnIndexSample">Use sample</button>
            </div>
            <pre id="outIndex" class="codebox mt-3"></pre>
          </div>
        </div>
      </section>

      <!-- Search -->
      <section class="tab-pane fade p-3" id="tab-search" role="tabpanel">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="row g-3 align-items-end">
              <div class="col-md-6">
                <label class="form-label">Query</label>
                <input id="sQuery" class="form-control" placeholder="search text" />
              </div>
              <div class="col-md-3">
                <label class="form-label">Field</label>
                <select id="sField" class="form-select">
                  <option value="valid_vec" selected>valid_vec (768)</option>
                  <option value="error_vec">error_vec (384)</option>
                </select>
              </div>
              <div class="col-md-2">
                <label class="form-label">Limit</label>
                <input id="sLimit" type="number" min="1" value="5" class="form-control" />
              </div>
              <div class="col-md-1">
                <button class="btn btn-primary w-100" id="btnSearch">Go</button>
              </div>
            </div>
            <div class="mt-3" id="outSearch"></div>
          </div>
        </div>
      </section>

      <!-- Ask (RAG) -->
      <section class="tab-pane fade p-3" id="tab-ask" role="tabpanel">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="row g-3 align-items-end">
              <div class="col-md-5">
                <label class="form-label">Question</label>
                <input id="askQ" class="form-control" placeholder="Your question" />
              </div>
              <div class="col-md-2">
                <label class="form-label">Context passages
                  <span class="text-secondary" data-bs-toggle="tooltip" title="How many retrieved snippets to include as context. Higher = more recall, lower = less noise.">(i)</span>
                </label>
                <input id="askK" type="number" min="1" value="3" class="form-control" />
              </div>
              <div class="col-md-2">
                <label class="form-label">Min score
                  <span class="text-secondary" data-bs-toggle="tooltip" title="Discard hits below this cosine similarity score (0–1).">(i)</span>
                </label>
                <input id="askMinScore" type="number" step="0.01" min="0" max="1" value="0.25" class="form-control" />
              </div>
              <div class="col-md-2">
                <label class="form-label">Max context (chars)</label>
                <input id="askMaxCtx" type="number" min="500" value="3000" class="form-control" />
              </div>
              <div class="col-md-1 form-check form-switch">
                <input id="askRerank" type="checkbox" class="form-check-input" />
                <label class="form-check-label" for="askRerank">Rerank</label>
              </div>
            </div>
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-primary" id="btnAsk">Ask</button>
              <button class="btn btn-outline-light btn-sm" id="btnAskSample">Use sample</button>
              <button class="btn btn-outline-light btn-sm" id="btnCopyAnswer">Copy answer</button>
            </div>
            <pre id="outAsk" class="codebox mt-3"></pre>
          </div>
        </div>
      </section>

      <!-- Text2SQL -->
      <section class="tab-pane fade p-3" id="tab-sql" role="tabpanel">
        <div class="card shadow-sm">
          <div class="card-body">
            <div class="row g-3 align-items-end">
              <div class="col-md-8">
                <label class="form-label">Question → SQL</label>
                <input id="sqlQ" class="form-control" placeholder="e.g., Top users by total order amount" />
              </div>
              <div class="col-md-2">
                <label class="form-label">Limit</label>
                <input id="sqlLimit" type="number" min="1" value="10" class="form-control" />
              </div>
              <div class="col-md-2 form-check form-switch mt-4">
                <input id="sqlExec" type="checkbox" class="form-check-input" checked />
                <label class="form-check-label" for="sqlExec">Execute</label>
              </div>
            </div>
            <div class="d-flex gap-2 mt-3">
              <button class="btn btn-primary" id="btnSQL">Run</button>
              <button class="btn btn-outline-light" id="btnSQLSample">Use sample</button>
              <button class="btn btn-outline-light" id="btnCopySQL">Copy SQL</button>
            </div>
            <div class="mt-3">
              <div class="mb-2"><span class="badge text-bg-secondary">SQL</span></div>
              <pre id="outSQL" class="codebox"></pre>
            </div>
            <div class="mt-3" id="outSQLRows"></div>
          </div>
        </div>
      </section>
    </div>
  </main>

  <!-- Toasts -->
  <div class="position-fixed bottom-0 end-0 p-3" style="z-index: 1080">
    <div id="toast" class="toast text-bg-dark border-0" role="alert" aria-live="assertive" aria-atomic="true">
      <div class="toast-header">
        <strong class="me-auto" id="toastTitle">Notice</strong>
        <small id="toastTime"></small>
        <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
      </div>
      <div class="toast-body" id="toastBody"></div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  <script src="./assets/js/app.js"></script>
</body>
</html>
